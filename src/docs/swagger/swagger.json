{
  "openapi": "3.0.0",
  "info": {
    "title": "NearTag API",
    "description": "API documentation for NearTag device management system",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    }
  ],
  "paths": {
    "/register": {
      "post": {
        "summary": "Register a new user",
        "description": "Create a new user account in the system",
        "tags": ["Authentication"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["username", "phone_number", "email", "password_u"],
                "properties": {
                  "username": {
                    "type": "string",
                    "minLength": 4,
                    "maxLength": 30,
                    "description": "User's username"
                  },
                  "phone_number": {
                    "type": "string",
                    "maxLength": 15,
                    "description": "User's phone number"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "User's email address"
                  },
                  "password_u": {
                    "type": "string",
                    "minLength": 8,
                    "maxLength": 60,
                    "description": "User's password"
                  }
                }
              },
              "example": {
                "username": "john_doe",
                "phone_number": "1234567890",
                "email": "john@example.com",
                "password_u": "securepassword123"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Usuario creado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "usuario creado con exito"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "400": {
            "description": "Error de validación",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "description": "Detalles del error de validación Zod"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "401": {
            "description": "El correo electrónico ya está registrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "este email ya esta registrado en otra cuenta"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error interno del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al crear usuario"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/login": {
      "post": {
        "summary": "Login user",
        "description": "Authenticate user and get access tokens",
        "tags": ["Authentication"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Usuario email"
                  },
                  "password": {
                    "type": "string",
                    "description": "Usuario password"
                  }
                }
              },
              "example": {
                "email": "usuario@example.com",
                "password": "password123"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login exitoso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string",
                      "description": "JWT token de acceso"
                    },
                    "refreshToken": {
                      "type": "string",
                      "description": "JWT token de actualización"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "username": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string",
                          "format": "email"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                  "user": {
                    "id": "123e4567-e89b-12d3-a456-426614174000",
                    "username": "usuario",
                    "email": "usuario@example.com"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Datos faltantes",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "email y contraseña son requeridos"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "401": {
            "description": "Credenciales inválidas",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "email no registrado | contraseña incorrecta"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "error al iniciar sesion"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/signOut": {
      "post": {
        "summary": "Cerrar sesión",
        "description": "Revoca los tokens del usuario y cierra la sesión",
        "tags": ["Authentication"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "header",
            "name": "Authorization",
            "required": true,
            "schema": {
              "type": "string",
              "example": "Bearer <token>"
            },
            "description": "Token de acceso"
          }
        ],
        "responses": {
          "200": {
            "description": "Sesión cerrada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "sesion cerrada exitosamente"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Token no proporcionado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "token id no proporcionado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "401": {
            "description": "No autenticado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "token inválido o expirado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al cerrar sesión"
                    },
                    "detail": {
                      "type": "string",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/assign": {
      "post": {
        "summary": "Asignar dispositivo a usuario",
        "description": "Asigna un nuevo dispositivo NearTag a un usuario",
        "tags": ["Devices"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["userId", "macAddress", "longitude", "latitude"],
                "properties": {
                  "userId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "ID del usuario"
                  },
                  "deviceName": {
                    "type": "string",
                    "description": "Nombre personalizado del dispositivo (opcional)"
                  },
                  "macAddress": {
                    "type": "string",
                    "description": "Dirección MAC del dispositivo"
                  },
                  "channel": {
                    "type": "number",
                    "description": "Canal de comunicación (opcional)"
                  },
                  "longitude": {
                    "type": "number",
                    "description": "Longitud geográfica"
                  },
                  "latitude": {
                    "type": "number",
                    "description": "Latitud geográfica"
                  }
                }
              },
              "example": {
                "userId": "123e4567-e89b-12d3-a456-426614174000",
                "deviceName": "Mi NearTag",
                "macAddress": "00:1A:2B:3C:4D:5E",
                "channel": 1,
                "longitude": -99.1332,
                "latitude": 19.4326
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Dispositivo asignado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "dispositivo asignado correctamente"
                    },
                    "device": {
                      "type": "object",
                      "properties": {
                        "id_device": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "name_device": {
                          "type": "string"
                        },
                        "status_d": {
                          "type": "string",
                          "enum": ["activo"]
                        },
                        "configuration": {
                          "type": "object",
                          "properties": {
                            "device_name": {
                              "type": "string"
                            },
                            "mac_address": {
                              "type": "string"
                            },
                            "channel": {
                              "type": "number"
                            }
                          }
                        },
                        "locations": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "longitude": {
                                "type": "number"
                              },
                              "latitude": {
                                "type": "number"
                              },
                              "date_l": {
                                "type": "string",
                                "format": "date-time"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validación",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "description": "Detalles del error de validación Zod"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos para asignar este dispositivo"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Usuario no encontrado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "409": {
            "description": "Conflicto",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "la dirección MAC ya está registrada en otro dispositivo"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al asignar el dispositivo"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/{deviceId}/lost": {
      "patch": {
        "summary": "Marcar dispositivo como perdido",
        "description": "Actualiza el estado de un dispositivo a perdido",
        "tags": ["Devices"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "deviceId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del dispositivo a marcar como perdido"
          }
        ],
        "responses": {
          "200": {
            "description": "Dispositivo marcado como perdido exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Dispositivo marcado como perdido"
                    },
                    "device": {
                      "type": "object",
                      "properties": {
                        "id_device": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "status_d": {
                          "type": "string",
                          "enum": ["perdido"]
                        },
                        "update_date": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "configuration": {
                          "type": "object",
                          "properties": {
                            "device_name": {
                              "type": "string"
                            },
                            "mac_address": {
                              "type": "string"
                            },
                            "channel": {
                              "type": "number"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos sobre este dispositivo"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Dispositivo no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Dispositivo no encontrado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al marcar el dispositivo como perdido"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/user/{userId}/devices": {
      "get": {
        "summary": "Obtener dispositivos del usuario",
        "description": "Obtiene todos los dispositivos asociados a un usuario específico",
        "tags": ["Devices"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario"
          }
        ],
        "responses": {
          "200": {
            "description": "Dispositivos encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "message": {
                          "type": "string",
                          "example": "No tienes dispositivos asociados."
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "userDevices": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name_device": {
                                "type": "string"
                              },
                              "status_d": {
                                "type": "string",
                                "enum": ["activo", "perdido", "inactivo"]
                              },
                              "update_date": {
                                "type": "string",
                                "format": "date-time"
                              },
                              "connections": {
                                "type": "array",
                                "items": {
                                  "type": "object"
                                }
                              },
                              "configuration": {
                                "type": "object",
                                "properties": {
                                  "device_name": {
                                    "type": "string"
                                  },
                                  "mac_address": {
                                    "type": "string"
                                  },
                                  "channel": {
                                    "type": "number"
                                  }
                                }
                              },
                              "locations": {
                                "type": "array",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "longitude": {
                                      "type": "number"
                                    },
                                    "latitude": {
                                      "type": "number"
                                    },
                                    "date_l": {
                                      "type": "string",
                                      "format": "date-time"
                                    }
                                  }
                                }
                              },
                              "records": {
                                "type": "array",
                                "items": {
                                  "type": "object"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos sobre este dispositivo"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "usuario no encontrado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al consultar los dispositivos"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/{deviceId}/delete": {
      "delete": {
        "summary": "Eliminar dispositivo",
        "description": "Elimina un dispositivo y todas sus relaciones asociadas",
        "tags": ["Devices"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "deviceId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del dispositivo a eliminar"
          }
        ],
        "responses": {
          "200": {
            "description": "Dispositivo eliminado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "neartag eliminado correctamente"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos sobre este dispositivo"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Dispositivo no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Dispositivo no encontrado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al eliminar el neartag"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/{deviceId}/location": {
      "get": {
        "summary": "Obtener ubicación actual",
        "description": "Obtiene la última ubicación registrada de un dispositivo",
        "tags": ["Devices"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "deviceId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del dispositivo"
          }
        ],
        "responses": {
          "200": {
            "description": "Ubicación encontrada",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "location": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "id_device": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "longitude": {
                          "type": "number",
                          "format": "float"
                        },
                        "latitude": {
                          "type": "number",
                          "format": "float"
                        },
                        "date_l": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "location": {
                    "id": "123e4567-e89b-12d3-a456-426614174000",
                    "id_device": "123e4567-e89b-12d3-a456-426614174001",
                    "longitude": -99.1332,
                    "latitude": 19.4326,
                    "date_l": "2024-05-21T15:30:00Z"
                  }
                }
              }
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos para acceder a la ubicación de este dispositivo"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "No encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No se encontró ubicación para este dispositivo"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al consultar la ubicación"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/user/{userId}/username": {
      "patch": {
        "summary": "Actualizar nombre de usuario",
        "description": "Actualiza el nombre de usuario de una cuenta",
        "tags": ["User"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["newUsername"],
                "properties": {
                  "newUsername": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 30,
                    "description": "Nuevo nombre de usuario"
                  }
                }
              },
              "example": {
                "newUsername": "nuevo_username"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Nombre de usuario actualizado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "username actualizado correctamente"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validación",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "object",
                      "description": "Detalles del error de validación Zod"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos para actualizar este usuario"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "este usuario no existe"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "error al cambiar el nombre de usuario"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/user/{userId}/email": {
      "patch": {
        "summary": "Actualizar correo electrónico",
        "description": "Actualiza el correo electrónico del usuario, requiere verificación de contraseña",
        "tags": ["User"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["newEmail", "password"],
                "properties": {
                  "newEmail": {
                    "type": "string",
                    "format": "email",
                    "description": "Nuevo correo electrónico"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8,
                    "description": "Contraseña actual para verificación"
                  }
                }
              },
              "example": {
                "newEmail": "nuevo@example.com",
                "password": "contraseña123"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Correo actualizado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "correo actualizado correctamente"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validación",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Datos inválidos"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error de validación Zod"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "401": {
            "description": "Contraseña incorrecta",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "La contraseña actual es incorrecta"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos para modificar la contraseña"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "este usuario no existe"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "409": {
            "description": "Correo en uso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Este correo ya está en uso por otra cuenta"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "error al actualizar el email"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/user/{userId}/phone-number": {
      "patch": {
        "summary": "Actualizar número telefónico",
        "description": "Actualiza el número de teléfono del usuario, requiere verificación de contraseña",
        "tags": ["User"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["newPhoneNumber", "password"],
                "properties": {
                  "newPhoneNumber": {
                    "type": "string",
                    "maxLength": 15,
                    "description": "Nuevo número telefónico"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8,
                    "description": "Contraseña actual para verificación"
                  }
                }
              },
              "example": {
                "newPhoneNumber": "1234567890",
                "password": "contraseña123"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Número actualizado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "numero de telefono actualizado correctamente"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validación",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Datos inválidos"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error de validación Zod"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "401": {
            "description": "Contraseña incorrecta",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "contraseña incorrecta"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos para modificar el numero de celular"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "este usuario no existe"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "409": {
            "description": "Número en uso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Este numero de telefono ya está en uso por otra cuenta"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "error al actualizar el numero de telefono"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/user/{userId}/password": {
      "patch": {
        "summary": "Actualizar contraseña",
        "description": "Actualiza la contraseña del usuario verificando la contraseña actual",
        "tags": ["User"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["currentPassword", "newPassword"],
                "properties": {
                  "currentPassword": {
                    "type": "string",
                    "minLength": 8,
                    "description": "Contraseña actual"
                  },
                  "newPassword": {
                    "type": "string",
                    "minLength": 8,
                    "description": "Nueva contraseña"
                  }
                }
              },
              "example": {
                "currentPassword": "contraseña_actual",
                "newPassword": "nueva_contraseña"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Contraseña actualizada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "contraseña actualizada correctamente"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validación",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Datos inválidos"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error de validación Zod"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "401": {
            "description": "Contraseña incorrecta",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "La contraseña actual es incorrecta"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permisos para modificar la contraseña"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "este usuario no existe"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "error al actualizar la contraseña"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/user/{userId}": {
      "get": {
        "summary": "Obtener datos del usuario",
        "description": "Obtiene los datos personales del usuario",
        "tags": ["User"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario"
          }
        ],
        "responses": {
          "200": {
            "description": "Usuario encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "usuario encontrado"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "username": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "phone_number": {
                          "type": "string"
                        },
                        "creation_date": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "update_date": {
                          "type": "string",
                          "format": "date-time",
                          "nullable": true
                        }
                      }
                    }
                  }
                },
                "example": {
                  "message": "usuario encontrado",
                  "user": {
                    "username": "john_doe",
                    "email": "john@example.com",
                    "phone_number": "1234567890",
                    "creation_date": "2024-05-21T15:30:00Z",
                    "update_date": null
                  }
                }
              }
            }
          },
          "403": {
            "description": "Sin permisos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No tiene permiso para acceder a estos datos"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "usuario no encontrado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "error al obtener los datos del usuario"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/refresh-token": {
      "post": {
        "summary": "Renovar token de acceso",
        "description": "Genera un nuevo token de acceso usando un token de actualización válido",
        "tags": ["Authentication"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["refreshToken"],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Token de actualización JWT"
                  }
                }
              },
              "example": {
                "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token renovado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string",
                      "description": "Nuevo token de acceso",
                      "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Token no proporcionado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Refresh token no proporcionado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "401": {
            "description": "Token inválido",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Token inválido o expirado"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Error al renovar el token"
                    },
                    "detail": {
                      "type": "object",
                      "description": "Detalles del error"
                    }
                  }
                }
              }
            },
            "default": {
              "$ref": "#/components/responses/NotFound"
            }
          }
        }
      }
    },
    "/*": {
      "get": {
        "summary": "Ruta no encontrada",
        "description": "Manejo de rutas inexistentes",
        "tags": ["Error Handlers"],
        "responses": {
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "post": {
        "$ref": "#/paths/~1*/get"
      },
      "put": {
        "$ref": "#/paths/~1*/get"
      },
      "patch": {
        "$ref": "#/paths/~1*/get"
      },
      "delete": {
        "$ref": "#/paths/~1*/get"
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "responses": {
      "NotFound": {
        "description": "Ruta no encontrada",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "error": {
                  "type": "string",
                  "example": "Ruta no encontrada"
                },
                "path": {
                  "type": "string",
                  "example": "/ruta-invalida"
                },
                "method": {
                  "type": "string",
                  "example": "GET"
                }
              }
            }
          }
        }
      }
    }
  }
}